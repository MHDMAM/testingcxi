<ion-view view-title="{{'transactions.topup.title' | translate}}"><ion-content class="page-padding"><div class="progress-container"><div class="progress-line"><div class="line line-3"><div class="progress-50"></div></div><div ng-class="{current:steps===1, completed:steps!==1}" class="stage stage-4"><span ng-if="steps==1" class="step-number">1</span><span ng-if="steps!=1" class="step-number ion-checkmark"></span><div class="step-label"> </div></div><div ng-class="{current:steps===2, completed:steps&gt;2}" class="stage stage-4"><span ng-if="steps!=4" class="step-number">2</span><span ng-if="steps&gt;2" class="step-number ion-checkmark"></span><div class="step-label"> </div></div><div ng-class="{current:steps===3, completed:steps===4}" class="stage stage-4"><span ng-if="steps!=4" class="step-number">3</span><span ng-if="steps==4" class="step-number ion-checkmark"></span><div class="step-label"> </div></div><div ng-class="{current:steps===4}" class="stage stage-4"><span class="step-number">4</span><div class="step-label"> </div></div></div></div><div id="step1" ng-if="steps===1"><div class="center margin-bottom-xl"><div ng-switch="viewData.topUpMode"><h2 translate="transactions.topup.Schedule_title" ng-switch-when="0"></h2><h2 translate="transactions.topup.add_hoc_title" ng-switch-when="1"></h2><h2 translate="transactions.topup.title_select" ng-switch-default="ng-switch-default"></h2></div></div><div class="row"><div class="col-90 center-block"><h3 translate="transactions.topup.details_title"></h3><div class="row has-border-padding margin-bottom-large"><div class="col-25 padding-right-medium"><div translate="transactions.topup.plan_name" class="pol-value"></div><div class="pol-property">{{data.policyInfo.planName}}</div></div><div class="col-25 padding-right-medium"><div translate="takaful.policy_no" ng-if="data.policyInfo.lineOfBiz ==='LAFT'" class="pol-value"></div><div translate="transactions.topup.policy_no" ng-if="data.policyInfo.lineOfBiz !=='LAFT'" class="pol-value"></div><div class="pol-property">{{data.policyInfo.policyNo}}</div></div><div class="col-25 padding-right-medium"><div translate="transactions.topup.insured_name" class="pol-value"></div><div class="pol-property">{{data.policyInfo.insuredName}}</div></div><div ng-if="viewData.topUpMode === 0" class="col-25 padding-right-medium"><div translate="takaful.policy_due_amount" ng-if="data.policyInfo.lineOfBiz ==='LAFT'" class="pol-value"></div><div translate="transactions.topup.premium_amount" ng-if="data.policyInfo.lineOfBiz !=='LAFT'" class="pol-value"></div><div class="pol-property">RM{{data.policyInfo.premiumAmount}}</div></div><div ng-if="viewData.topUpMode === 1" class="col-25 padding-right-medium"><div translate="transactions.topup.outstanding_coi" class="pol-value"></div><div class="pol-property">RM{{data.policyInfo.coverageDebt}}</div></div></div></div></div><div class="full-bleed margin-bottom-xl"><form name="step1Form"><div class="col-90 center-block"><div class="row"><div class="col-33 padding-right-medium"><span translate="transactions.topup.wanna_to"></span><label class="item item-input selectArrow"><select ng-model="viewData.topUpMode" ng-options="value.val as value.name for value in viewData.topUpValues" ng-change="topUpModeChange()" class="formInput"><option value="">Please select</option></select></label></div><div class="col-33 padding-right-medium"><div class="row"><div class="col-50 padding-right-medium"><span translate="transactions.topup.premium_of"></span><label class="item item-input input-margin"><input type="number" ng-model="data.premiumVal" ng-change="updateFund($index)" min="{{viewData.minTopUp}}" ng-model-options="{ updateOn: 'default blur', debounce: {'default': 500, 'blur': 0} }" required="required"/></label><div class="subline-container"><span>Minimum amount required is RM{{viewData.minTopUp}}.</span></div></div><div class="col-50"><span>&nbsp;</span><label ng-show="viewData.topUpMode===0" ng-class="{'disabledItem': viewData.topUpMode===1 || data.policyInfo.policyStatusCode!=='SP'}" class="item item-input selectArrow"><span ng-show="viewData.topUpMode===1 || data.policyInfo.policyStatusCode!=='SP'" style="padding: 6px 0 6px" class="formInput">{{data.frequency.key}}</span><select ng-hide="viewData.topUpMode===1 || data.policyInfo.policyStatusCode!=='SP'" style="padding: 6px 0 6px" ng-model="data.frequency" ng-options="value as value.key for value in viewData.freqs" class="formInput"><option value="">Frequency</option></select></label></div></div></div><div class="col-33"><span translate="transactions.topup.select_your_allocation"></span><label class="item item-input selectArrow"><select ng-model="viewData.allocationType" ng-options="value.val as value.name for value in viewData.allocationTypes" required="required" class="formInput"><option value="">Please select</option></select></label></div></div></div></form></div><div class="row"><div class="col-90 center-block"><div class="margin-bottom-medium"><span class="padding-right-xxs"><strong translate="transactions.topup.notes"></strong></span><span translate="transactions.topup.notes_txt"></span></div></div></div><div class="row"><button ng-click="updateState(2)" translate="transactions.topup.next" ng-disabled="step1Form.$invalid &amp;&amp; checkTotal()" class="center-block button button-major button-wide"></button></div></div><div id="step2" ng-if="steps===2"><div class="center margin-bottom-xl"><div ng-switch="viewData.topUpMode"><h2 translate="transactions.topup.tilte_step2"></h2></div></div><form name="step2Form"><div ng-show="viewData.topUpMode!==null &amp;&amp; data.premiumVal" class="row"><div class="col-90 center-block"><div class="row table-header2"> <div class="col-33"><span translate="transactions.topup.fund_name"></span></div><div class="col-33"><span translate="transactions.topup.fund_value" class="width-75"></span></div><div class="col-33"><span translate="transactions.topup.allocation"></span></div></div><div class="row"><hr/></div><div class="row topup-scroll"><ion-content><div ng-repeat="item in data.fundAllocation" ng-class="{'full-bleed': item.highlight}" class="row fund-row topup-scroll-row"><div class="col-33"><label ng-class="{'disabledItem': !item.isEnabled}" class="item item-input selectArrow"><select ng-change="onChangeFund($index)" ng-model="data.fundAllocation[$index]" ng-options="fund as fund.typeOfFund for fund in data.fundDetails" ng-if="viewData.allocationType == 2" ng-disabled="!item.isEnabled" class="formInput"></select><select ng-change="onChangeFund($index)" ng-model="data.fundAllocation[$index]" ng-options="fund as fund.typeOfFund for fund in data.fundAllocation" ng-if="viewData.allocationType == 1" ng-disabled="!item.isEnabled" class="formInput"><option value=""></option></select></label></div><div class="col-33"><span class="span-vertical-center width-75">{{item.valueOfUnits}}</span></div><div class="col-33"><div class="col"><div class="row"><div class="col-25"><label ng-class="{'disabledItem': !item.isEnabled}" style="width: 80px;" class="item item-input"><input type="number" min="0" max="100" ng-model="item.allocationPercent" ng-change="updateAllocation($index)" ng-disabled="!item.isEnabled" ng-model-options="{ updateOn: 'default blur', debounce: {'default': 500, 'blur': 0} }"/></label></div><div class="col-75"><div class="row"><div ng-if="viewData.allocationType == 2" class="col-50"><span class="span-vertical-center padding-left-xxs"></span><div ng-click="editAllocation($index)" class="pull-right major-link blue"><span translate="transactions.topup.edit" class="span-vertical-center"></span><span class="span-vertical-center ion-edit"></span></div></div><div ng-if="viewData.allocationType == 2" class="col-33"><span class="span-vertical-center padding-left-xxs"></span><div ng-click="removeAllocation($index)" class="pull-right major-link stable"><span translate="transactions.topup.remove" class="span-vertical-center"></span><span class="span-vertical-center ion-android-close"></span></div></div></div></div></div></div></div></div></ion-content></div><div class="clearfix"></div><div ng-if="viewData.allocationType===2" class="row"><div class="col"><div ng-click="addFund()" ng-show="data.fundAllocation.length &lt; 10" class="major-link blue"><span translate="transactions.topup.add_fund"></span><span class="ion-plus"></span></div></div></div><div class="checkbox-display-with-terms"><div class="agree-checkbox margin-top-medium margin-bottom-medium"><li class="item item-checkbox"><label class="checkbox"><input type="checkbox" name="tnc" ng-model="viewData.tncChecked" required="required"/></label><span>{{'transactions.medcard_replacement.read_tnc1' | translate}}&nbsp;</span></li><span translate="transactions.medcard_replacement.read_tnc2" ng-click="termsNconditions()" class="inline-link"> </span></div></div></div></div><div class="center"><button ng-click="updateState(3)" translate="transactions.topup.pay_later" ng-if="viewData.topUpMode === 0" class="button button-calm button-wide button-major"></button><button ng-click="payment()" translate="transactions.topup.to_payment" ng-disabled="!viewData.tncChecked || !viewData.fundTotal100" class="button button-major button-wide"></button></div></form></div><div id="step3" ng-if="steps===3"><div class="center margin-bottom-xl"><h2 translate="transactions.topup.tilte_step3"></h2></div><div class="row"><div class="col-90 center-block"><div class="row"><div class="col-50"><h3 translate="transactions.topup.fund_details"></h3><div class="row"><div class="col"><div class="item-container"><div translate="transactions.topup.plan_name" class="pol-value"></div><div class="pol-property">{{data.policyInfo.planName}}</div></div></div></div><div class="row"><div class="col"><div class="item-container"><div translate="takaful.policy_no" ng-if="data.policyInfo.lineOfBiz ==='LAFT'" class="pol-value"></div><div translate="transactions.topup.policy_no" ng-if="data.policyInfo.lineOfBiz !=='LAFT'" class="pol-value"></div><div class="pol-property">{{data.policyInfo.policyNo}}</div></div></div></div><div class="row"><div class="col"><div class="item-container"><div translate="transactions.topup.insured_name" class="pol-value"></div><div class="pol-property">{{data.policyInfo.insuredName}}</div></div></div></div><div class="row"><div class="col"><div class="item-container"><div translate="transactions.topup.premium_amount" ng-if="data.policyInfo.lineOfBiz !=='LAFT'" class="pol-value"></div><div translate="takaful.policy_due_amount" ng-if="data.policyInfo.lineOfBiz ==='LAFT'" class="pol-value"></div><div class="pol-property">{{data.policyInfo.premiumAmount}}</div></div></div></div></div><div class="col-50"><div class="row"><div class="col"><h3 translate="transactions.topup.fund_allocation"></h3><div class="row table-header2"><div class="col-67"><span translate="transactions.topup.fund_name"></span></div><div class="col-33"><span translate="transactions.topup.allocation" class="pull-right"></span></div></div><div class="row topup-scroll"><ion-content><div ng-repeat="item in data.fundAllocation" class="row table-row2"><div class="col-67"><span>{{item.typeOfFund}}</span></div><div class="col-33"><span>{{item.allocationPercent}}</span></div></div></ion-content></div></div></div></div></div></div></div><div class="full-bleed margin-bottom-large"><div class="row"><div class="col-90 center-block"><div class="form-container">     <span class="pol-value">{{'transactions.dc.step3.enter_vcode_title' | translate}} {{viewData.userInfo.mobileNo | phonemask}}</span><span translate="transactions.dc.step3.enter_vcode_title2" class="pol-value"></span><form name="step3Form" class="verification-block">      <label class="item item-input margin-bottom-small margin-top-small"><input type="number" ng-model="data.verificationCode" placeholder="Enter verification code" translate="transactions.dc.step3.resend_code" required="required" minlength="6" maxlength="6" class="center-block"/></label><button ng-click="requestOTP()" translate="transactions.dc.step3.resend_code" class="button button-calm button-wide button-major"></button></form></div></div></div></div><div class="row"><div class="col"><div class="center-buttons"><button ng-click="cancel()" translate="transactions.topup.cancel" class="button button-calm button-wide button-major"></button><button ng-click="submit()" translate="transactions.topup.confirm" ng-disabled="step3Form.$invalid" class="button button-major button-wide"></button></div></div></div></div><div id="step4" ng-if="steps===4"><div class="center margin-bottom-xl"><h2 translate="transactions.topup.tilte_step4"></h2></div><div class="row"><div class="col-90 center-block"><div class="row"><div class="col-50"><h3 translate="transactions.topup.fund_details"></h3><div class="row"><div class="col"><div class="item-container"><div translate="transactions.topup.plan_name" class="pol-value"></div><div class="pol-property">{{data.policyInfo.planName}}</div></div></div></div><div class="row"><div class="col"><div class="item-container"><div translate="takaful.policy_no" ng-if="data.policyInfo.lineOfBiz ==='LAFT'" class="pol-value"></div><div translate="transactions.topup.policy_no" ng-if="data.policyInfo.lineOfBiz !=='LAFT'" class="pol-value"></div><div class="pol-property">{{data.policyInfo.policyNo}}</div></div></div></div><div class="row"><div class="col"><div class="item-container"><div translate="transactions.topup.insured_name" class="pol-value"></div><div class="pol-property">{{data.policyInfo.insuredName}}</div></div></div></div><div class="row"><div class="col"><div class="item-container"><div translate="transactions.topup.premium_amount" ng-if="data.policyInfo.lineOfBiz !=='LAFT'" class="pol-value"></div><div translate="takaful.policy_due_amount" ng-if="data.policyInfo.lineOfBiz ==='LAFT'" class="pol-value"></div><div class="pol-property">{{data.policyInfo.premiumAmount}}</div></div></div></div></div><div class="col-50"><div class="row"><div class="col"><h3 translate="transactions.topup.fund_allocation"></h3><div class="row table-header2"><div class="col-67"><span translate="transactions.topup.fund_name"></span></div><div class="col-33"><span translate="transactions.topup.allocation" class="pull-right"></span></div></div><div class="row topup-scroll"><ion-content><div ng-repeat="item in data.fundAllocation" class="row table-row2"><div class="col-67"><span>{{item.typeOfFund}}</span></div><div class="col-33"><span>{{item.allocationPercent}}</span></div></div></ion-content></div></div></div></div></div></div></div><div class="center"><button ng-click="finish()" translate="transactions.topup.back_to_dashboard" class="button button-major button-wide"></button></div></div></ion-content></ion-view>