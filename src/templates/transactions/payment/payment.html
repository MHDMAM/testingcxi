<ion-view view-title="{{'payment.make.title' | translate}}" hide-nav-bar="steps===4"><ion-content scroll="false" class="page-padding"><div class="progress-container"><div class="progress-line"><div class="line line-3"><div class="progress-50"></div></div><div ng-class="{current:steps===1, completed:steps!==1}" class="stage stage-3"><span ng-if="steps==1" class="step-number">1</span><span ng-if="steps!=1" class="step-number ion-checkmark"></span><div class="step-label"></div></div><div ng-class="{current:steps===2, completed:steps===3}" class="stage stage-3"><span ng-if="steps!=3" class="step-number">2</span><span ng-if="steps==3" class="step-number ion-checkmark"></span><div class="step-label"></div></div><div ng-class="{current:steps===3}" class="stage stage-3"><span class="step-number">3</span><div class="step-label"></div></div></div></div><div id="step1" ng-if="steps===1" class="full-bleed2"><div class="center"><h2 translate="payment.make.makePayment"></h2></div><div class="row payment-card"><div class="col-33 payment-left-pane pane-scroll"><ion-content><div ng-repeat="item in paymentCard" ng-class="{'payment-card-selected': item.actions.current}" ng-click="onPolicyClickStep1($index)" class="row payment-left-pane-item"><div class="col-10"><div class="item item-checkbox"><div class="checkbox"><input type="checkbox" ng-model="item.actions.selected" ng-change="updateGrand()" checklist-value="item" checklist-model="selectedPolices"/></div></div></div><div class="col-90 padding-left-xxs"><div class="payment-item-icon"><svg role="img" title="lifepro-prime1" class="icon-xs"><use xlink:href="img/icons.svg#lifepro-prime1"></use></svg></div><div style="max-width: 229px;" class="policy-pay-item"><h4>{{item.planName}}</h4><span ng-if="item.lineOfBiz !== 'LAFT'">{{'payment.make.next_due' | translate}} {{item.premiumDueDate}}</span><span ng-if="item.lineOfBiz === 'LAFT'">{{'takaful.premium_due_date' | translate}} {{item.premiumDueDate}}</span><h5>RM{{item.actions.total | fix2}}</h5></div><div ng-show="item.actions.current" class="glyph-arrow"><svg role="img" title="#" class="icon-arrow"><use xlink:href="img/icons.svg#arrow-red"></use></svg></div></div></div></ion-content><div class="payment-left-bottom"><div class="row grand-total"><div class="col-50"><h4 translate="payment.make.grand_total"></h4></div><div class="col-50"><span>RM{{data.grandTotal}}</span></div></div><div class="payment-left-buttons"><button ng-click="updateState(2)" translate="payment.make.next" ng-disabled="selectedPolices.length===0" class="center-block button button-major button-full"></button></div></div></div><div class="col-67 padding-large"><div class="row"><div class="col-50"><h4 class="margin-bottom-small">{{selectedPolicy.planName}}</h4><span class="margin-bottom-small negative-margin pol-value2">{{selectedPolicy.lineOfBiz | lineofbiztotext}}</span><div class="item-container"><span translate="takaful.policy_no" ng-if="selectedPolicy.lineOfBiz === 'LAFT'" class="pol-value"></span><span translate="payment.make.policy_no" ng-if="selectedPolicy.lineOfBiz !== 'LAFT'" class="pol-value"></span><span class="pol-property2">: {{selectedPolicy.policyNo}}</span></div><div ng-click="showInfoModal()" class="item-container"><span translate="takaful.policy_status" ng-if="selectedPolicy.lineOfBiz === 'LAFT'" class="pol-value"></span><span translate="payment.make.policy_status" ng-if="selectedPolicy.lineOfBiz !== 'LAFT'" class="pol-value"></span><span class="pol-property2 p-red-color">{{selectedPolicy.policyStatus}}</span></div><div ng-show="isInForceETI(selectedPolicy) || isLapsed(selectedPolicy.policyStatus)" class="item-container"><span translate="payment.make.reinstatement_cost" class="pol-value"></span><span class="pol-property2">: {{selectedPolicy.reinstatementOutstandingAmount}}</span></div><div ng-show="isInForceSVE(selectedPolicy.policyStatus)" class="item-container"><span translate="payment.make.outstanding_premium_interest" class="pol-value"></span><span class="pol-property2">: {{selectedPolicy.outstandingPremWithGST_changeFreq}}</span></div><div ng-show="isInForceETI(selectedPolicy.policyStatus)" class="item-container"><span class="pol-property2">{{'payment.make.last_paid_date' | translate}} : {{selectedPolicy.lastPaidToDate}}</span></div><div class="item-container"><span translate="payment.make.insured_name" class="pol-value"></span><span class="pol-property2">: {{selectedPolicy.insuredName}}</span></div><div class="item-container"><span translate="payment.make.premium_amount" ng-if="selectedPolicy.totalPremiumAmount" class="pol-value"> </span><span class="pol-property2">: RM{{selectedPolicy.totalPremiumAmount}}</span><p class="sub-text no-margin">{{selectedPolicy | paymentSimple}}</p><p class="sub-text no-margin">{{selectedPolicy.freq | duepay}}</p></div><div class="item-container"><span translate="takaful.premium_due_date" ng-if="selectedPolicy.lineOfBiz === 'LAFT'" class="pol-value"></span><span translate="payment.make.next_due" ng-if="selectedPolicy.lineOfBiz !== 'LAFT'" class="pol-value"></span><span class="pol-property2">{{selectedPolicy.premiumDueDate}}</span></div><span translate="payment.make.select_advance_payment" ng-hide="selectedPolicy.lineOfBiz == 'PA'" class="block bottom-padding-4"></span><aia-incremental init-val="selectedPolicy.initVal" max-val="selectedPolicy.freq" myupdate="updateAdvance()" ng-hide="selectedPolicy.lineOfBiz == 'PA'"></aia-incremental><span ng-hide="selectedPolicy.lineOfBiz == 'PA'">{{selectedPolicy.freqDesc}}</span><ui class="list"><li ng-if="selectedPolicy.aplWithInterest &amp;&amp; selectedPolicy.aplWithInterest &gt;0" class="item item-checkbox"><label class="checkbox"><input type="checkbox" ng-model="selectedPolicy.actions.aplSelected" ng-change="calcTotalApl()"/></label>{{'payment.make.apl' | translate}} - {{selectedPolicy.aplWithInterest}}</li><li ng-if="selectedPolicy.policyLoanWithInterest &amp;&amp; selectedPolicy.policyLoanWithInterest &gt;0" class="item item-checkbox"><label class="checkbox"><input type="checkbox" ng-model="selectedPolicy.actions.loanSelected" ng-change="calcTotalLoan()"/></label>{{'payment.make.policy_loan' | translate}} - {{selectedPolicy.policyLoanWithInterest}}</li></ui></div><div class="col-50 payment-col"><div ng-hide="isLapsed(selectedPolicy) || isInForceETI(selectedPolicy) || isInForceSVE(selectedPolicy) || selectedPolicy.totalPremiumAmount === 0" class="row"><div class="col-33"> <span translate="payment.make.current"></span></div><div class="col-33"><span>RM</span></div><div class="col-33"><span class="pull-right">{{selectedPolicy.totalPremiumAmount}}</span></div></div><div ng-show="isLapsed(selectedPolicy) || isInForceETI(selectedPolicy) || isCA(selectedPolicy)" class="row"><div class="col-33"> <span translate="payment.make.reinstatement"></span></div><div class="col-33"><span>RM</span></div><div class="col-33"><span class="pull-right">{{selectedPolicy.reinstatementOutstandingAmount}}</span></div></div><div ng-show="isInForceSVE(selectedPolicy)" class="row"><div class="col-33"> <span translate="payment.make.outstanding_premium_interest"></span></div><div class="col-33"><span>RM</span></div><div class="col-33"><span class="pull-right">{{selectedPolicy.reinstatementOutstandingAmount}}</span></div></div><div ng-if="selectedPolicy.lineOfBiz !=='PA' || !isInForceSVE(selectedPolicy.policyStatus)" class="row"><div class="col-33"><span translate="payment.make.advance"></span></div><div class="col-33"><span>RM</span></div><div class="col-33"><span class="pull-right">{{selectedPolicy.advance}}</span></div></div><div ng-if="selectedPolicy.actions.aplSelected" class="row optional"><div class="col-33"><span translate="payment.make.apl"></span></div><div class="col-33"><span>RM</span></div><div class="col-33"><input type="number" ng-model="selectedPolicy.apl" min="{{selectedPolicy.actions.aplMin}}" max="{{selectedPolicy.actions.aplMax}}" ng-disabled="selectedPolicy.actions.aplDisabled" ng-change="calcTotalApl(1)" ng-model-options="{ updateOn: 'default blur', debounce: {'default': 5000, 'blur': 0} }" class="optional-payment-input"/></div></div><div ng-if="selectedPolicy.actions.loanSelected" class="row optional"><div class="col-33"><span translate="payment.make.policy_loan"></span></div><div class="col-33"><span>RM</span></div><div class="col-33"><input type="number" ng-model="selectedPolicy.loan" min="{{selectedPolicy.actions.loanMin}}" max="{{selectedPolicy.actions.loanMax}}" ng-disabled="selectedPolicy.actions.loanDisabled" ng-change="calcTotalLoan(1)" ng-model-options="{ updateOn: 'default blur', debounce: {'default': 5000, 'blur': 0} }" class="optional-payment-input"/></div></div><div class="row"><div class="col-33"><span translate="payment.make.total"></span></div><div class="col-33"><span>RM</span></div><div class="col-33"><span class="pull-right">{{selectedPolicy.actions.total |fix2}}</span></div></div></div></div></div></div></div><div id="step2" ng-if="steps===2" class="full-bleed2 ng-enter"><div class="center"><h2 translate="payment.select.makePayment"></h2></div><div class="row payment-card"><div class="col-33 payment-left-pane pane-scroll"><ion-content><div ng-repeat="item in selectedPolices" ng-class="{'payment-card-selected': item.actions.current}" ng-click="onPolicyClickStep2($index)" class="row payment-left-pane-item"><div class="col padding-left-xxs"><div class="payment-item-icon"><svg role="img" title="lifepro-prime1" class="icon-xs"><use xlink:href="img/icons.svg#lifepro-prime1"></use></svg></div><div class="policy-pay-item"><h4>{{item.planName}}</h4><span ng-if="item.lineOfBiz !== 'LAFT'">{{'payment.select.next_due' | translate}} {{item.premiumDueDate}}</span><span ng-if="item.topUpAmount" class="pol-value">Topup Amount {{item.topUpAmount}}</span><span ng-if="item.lineOfBiz === 'LAFT'">{{'takaful.premium_due_date' | translate}} {{item.premiumDueDate}}</span><h5>RM{{item.actions.total | fix2}}</h5></div><div ng-show="item.actions.current" class="glyph-arrow"><svg role="img" title="#" class="icon-arrow"><use xlink:href="img/icons.svg#arrow-red"></use></svg></div></div></div></ion-content><div class="payment-left-bottom"><div class="row grand-total"><div class="col-50"><h4 translate="payment.select.grand_total"></h4></div><div class="col-50"><span>RM{{data.grandTotal | aiadecimal}}</span></div></div><div class="payment-left-buttons"><label class="item item-input selectArrow"><select name="paymentType" ng-model="data.paymentType" ng-options="item.id as item.title for item in viewData.payments" required="required"><option value="" translate="payment.select.select_payment"></option></select></label><div class="row"><div class="col-50 padding-right-xxs"><button ng-click="updateState(1)" translate="payment.select.back" ng-disabled="disableStep1Back" class="center-block button button-major button-full button-calm"></button></div><div class="col-50 padding-left-xxs"><button ng-click="goPayment()" translate="payment.make.next" ng-disabled="!data.paymentType" class="center-block button button-major button-full"></button></div></div></div></div></div><div class="col-67 padding-large"><div class="row"><div class="col-50"><h4 class="margin-bottom-small">{{selectedPolicy.planName}}</h4><span class="margin-bottom-small negative-margin pol-value2">{{selectedPolicy.lineOfBiz | lineofbiztotext}}</span><div class="item-container"><span translate="takaful.policy_no" ng-if="selectedPolicy.lineOfBiz === 'LAFT'" class="pol-value"></span><span translate="payment.select.policy_no" ng-if="selectedPolicy.lineOfBiz !== 'LAFT'" class="pol-value"></span><span class="pol-property2">: {{selectedPolicy.policyNo}}</span></div><div class="item-container"><span translate="takaful.policy_status" ng-if="selectedPolicy.lineOfBiz === 'LAFT'" class="pol-value"></span><span translate="payment.select.policy_status" ng-if="selectedPolicy.lineOfBiz !== 'LAFT'" class="pol-value"></span><span class="pol-property2 p-red-color">{{selectedPolicy.policyStatus}}</span></div><div ng-show="isInForceETI(selectedPolicy) || isLapsed(selectedPolicy)" class="item-container"><span translate="payment.select.reinstatement_cost" class="pol-value"></span><span class="pol-property2">: {{selectedPolicy.reinstatementOutstandingAmount}}</span></div><div ng-show="isInForceSVE(selectedPolicy.policyStatus)" class="item-container"><span translate="payment.select.outstanding_premium_interest" class="pol-value"></span><span class="pol-property2">: {{selectedPolicy.reinstatementOutstandingAmount}}</span></div><div ng-show="isInForceETI(selectedPolicy)" class="item-container"><span class="pol-property2">{{'payment.select.last_paid_date' | translate}} : {{selectedPolicy.lastPaidToDate}}</span></div><div class="item-container"><span translate="payment.select.insured_name" class="pol-value"></span><span class="pol-property2">: {{selectedPolicy.insuredName}}</span></div><div ng-hide="selectedPolicy.topUpAmount" ng-if="selectedPolicy.totalPremiumAmount" class="item-container"><span translate="payment.select.premium_amount" ng-if="selectedPolicy.lineOfBiz !== 'LAFT'" class="pol-value"></span><span translate="takaful.policy_due_amount" ng-if="selectedPolicy.lineOfBiz === 'LAFT'" class="pol-value"> </span><span class="pol-property2">: RM{{selectedPolicy.totalPremiumAmount}}</span><p class="sub-text no-margin">{{selectedPolicy | paymentSimple}}</p><p class="sub-text no-margin">{{selectedPolicy.freq | duepay}}</p></div><div class="item-container"><span translate="takaful.premium_due_date" ng-if="selectedPolicy.lineOfBiz === 'LAFT'" class="pol-value"></span><span translate="payment.select.next_due" ng-if="selectedPolicy.lineOfBiz !== 'LAFT'" class="pol-value"></span><span class="pol-property2">{{selectedPolicy.premiumDueDate}}</span></div></div><div class="col-50 payment-col"><div ng-hide="isLapsed(selectedPolicy) || isInForceETI(selectedPolicy) || isInForceSVE(selectedPolicy) || selectedPolicy.totalPremiumAmount === 0" class="row"><div class="col-33"> <span translate="payment.select.current"></span></div><div class="col-33"><span>RM</span></div><div class="col-33"><span class="pull-right">{{selectedPolicy.totalPremiumAmount}}</span></div></div><div ng-show="isLapsed(selectedPolicy) || isInForceETI(selectedPolicy) || isCA(selectedPolicy)" class="row"><div class="col-33"> <span translate="payment.select.reinstatement"></span></div><div class="col-33"><span>RM</span></div><div class="col-33"><span class="pull-right">{{selectedPolicy.reinstatementOutstandingAmount}}</span></div></div><div ng-show="isInForceSVE(selectedPolicy)" class="row"><div class="col-33"> <span translate="payment.select.outstanding_premium_interest"></span></div><div class="col-33"><span>RM</span></div><div class="col-33"><span class="pull-right">{{selectedPolicy.reinstatementOutstandingAmount}}</span></div></div><div ng-if="selectedPolicy.advance" class="row"><div class="col-33"><span translate="payment.select.advance"></span></div><div class="col-33"><span>RM</span></div><div class="col-33"><span class="pull-right">{{selectedPolicy.advance}}</span></div></div><div ng-if="selectedPolicy.actions.aplSelected" class="row optional"><div class="col-33"><span translate="payment.make.apl"></span></div><div class="col-33"><span>RM</span></div><div class="col-33"><input type="number" ng-model="selectedPolicy.apl" min="{{selectedPolicy.actions.aplMin}}" max="{{selectedPolicy.actions.aplMax}}" ng-disabled="selectedPolicy.actions.aplDisabled" ng-change="calcTotalApl(1)" ng-model-options="{ updateOn: 'default blur', debounce: {'default': 500, 'blur': 0} }" class="optional-payment-input"/></div></div><div ng-if="selectedPolicy.topUpAmount" class="row"><div class="col-33"><span>New Topup Amount</span></div><div class="col-33"><span>RM</span></div><div class="col-33"><span class="pull-right">{{selectedPolicy.topUpAmount}}</span></div></div><div ng-if="item.actions.aplSelected" class="row optional"><div class="col-33"><span translate="payment.select.apl"></span></div><div class="col-33"><span>RM</span></div><div class="col-33"><input type="number" ng-model="item.apl" min="{{selectedPolicy.actions.aplMin}}" max="{{selectedPolicy.actions.aplMax}}" ng-disabled="selectedPolicy.actions.aplDisabled" ng-change="calcTotalApl(1)" ng-model-options="{ updateOn: 'default blur', debounce: {'default': 500, 'blur': 0} }" class="optional-payment-input"/></div></div><div ng-if="selectedPolicy.actions.loanSelected" class="row optional"><div class="col-33"><span translate="payment.select.policy_loan"></span></div><div class="col-33"><span>RM</span></div><div class="col-33"><input type="number" ng-model="selectedPolicy.loan" min="{{selectedPolicy.actions.loanMin}}" max="{{selectedPolicy.actions.loanMax}}" ng-disabled="selectedPolicy.actions.loanDisabled" ng-change="calcTotalLoan(1)" ng-model-options="{ updateOn: 'default blur', debounce: {'default': 500, 'blur': 0} }" class="optional-payment-input"/></div></div><div class="row"><div class="col-33"><span translate="payment.select.total"></span></div><div class="col-33"><span>RM</span></div><div class="col-33"><span class="pull-right">{{selectedPolicy.actions.total |fix2}}</span></div></div></div></div></div></div></div><div id="step2" ng-if="steps===3" class="ng-enter"><div class="center margin-bottom-large"><h2 translate="payment.thanks.makePayment"></h2><span translate="payment.thanks.headerL2" class="block"></span></div><div class="row payment-receipt-card"><div class="col-80 center-block pane-scroll"><ion-content><div ng-repeat="item in data.receipts" class="row pol-row"><div class="col-67"><div class="policy-item-icon"><svg role="img" title="lifepro-prime1" class="icon-s"><use xlink:href="img/icons.svg#lifepro-prime1"></use></svg></div><h4 class="margin-bottom-xxs">{{item.planName}}, {{item.lineOfBiz | lineofbiztotext}}</h4><div class="item-container"><span translate="takaful.policy_no" ng-if="item.lineOfBiz === 'LAFT'" class="pol-value"></span><span translate="payment.thanks.policy_no" ng-if="item.lineOfBiz !== 'LAFT'" class="pol-value"></span><span class="pol-property2">{{item.policyNo}}</span><span translate="payment.thanks.receiptNo" ng-if="item.respCode === '0'" style="padding-left: 64px;" class="pol-value"></span><span style="padding-left: 64px;" class="pol-property2">{{item.receiptNo}}</span><span ng-if="item.respCode !== &quot;0&quot;" style="padding-left: 64px;" class="pol-property2">{{item.respDesc}}</span></div></div><div class="col-33 pull-right payment-col"><div ng-if="item.total || item.topUpAmount" class="row grand-total"><div class="col-33"> <span translate="payment.thanks.total" class="font-normal"></span></div><div class="col-33"><span>RM</span></div><div class="col-33"><span ng-hide="item.respCode !== &quot;0&quot;" class="pull-right">{{item.total | aiadecimal}}</span><span ng-show="item.respCode !== &quot;0&quot;" class="pull-right">N/A</span></div></div></div></div></ion-content></div></div><div class="row grand-total-block"><div class="col-80 center-block"><div class="row"><div class="col-67"></div><div class="col-33"><div class="row grand-total"><div class="col-33"><h4 translate="payment.thanks.grand_total"></h4></div><div class="col-33"><span>RM</span></div><div class="col-33"><span>{{data.grandTotal | aiadecimal}}</span></div></div></div></div></div></div><div class="row"><div class="col"><button ng-click="finishPayment()" translate="payment.thanks.next" class="center-block button button-major button-wide"></button></div></div></div><div id="step4" ng-if="steps===4" class="ng-enter"><button ng-click="closePayment()" class="button button-icon icon close-btn ion-ios-close"></button><iframe ng-src="{{paymentUrl}}" class="payment-iframe"></iframe></div></ion-content></ion-view>